@startuml RavenDB

' configuration
hide circle
skinparam linetype ortho

entity User {
    * id : text <<generated>>
    --
    * username : text
    * team_id : text <<FK>>
    * coe_id : text <<FK>>
    * user_type_id : text <<FK>>
}

entity Team {
    * id : text <<generated>>
    --
    * team_name : text
}

entity CoE {
    * id : text <<generated>>
    --
    * coe_name : text
    * coe_address : text
    * coe_city : text
    * coe_cap : text
}

entity UserType {
    * id : text <<generated>>
    --
    * name : text
    * description : text
    * metadata_search : integer
    * data_access : text
    * cohort_builder : text
    * data_quality : text
    * algorithms : text
    * results_report : text
}

entity Permit {
    * id : text <<generated>>
    --
    * permit_name : text
    * permit_description : text
    * creation_date : text
    * update_date : text
    * expiring_date : text
    * valid_status : integer <<FK>>
    * user_id : text <<FK>>
    * team_id : text <<FK>>
    * coe_id : text <<FK>>
    * workspace_id : text <<FK>>
    * metadata_id : text <<FK>>
}

entity Workspace {
    * id : text <<generated>>
    --
    * name : text
    * description : text
    * creation_date : text
    * user_id : text <<FK>>
    * team_id : text <<FK>>
    * metadata_search_status : integer <<FK>>
    * data_access_status : integer <<FK>>
    * data_analysis_status : integer <<FK>>
    * result_report_status : integer <<FK>>
}

entity Status {
    * id : integer <<generated>>
    --
    * status_type : text <<enum: "Permit", "WorkspacePhase">>
    * status_name : text
    * status_description : text
}

entity WorkspaceHistory {
    * id : text <<generated>>
    --
    * date : text
    * action : text
    * phase : text
    * details : text
    * user_id : text <<FK>>
    * workspace_id : text <<FK>>
}

entity Analysis {
    * id : text <<generated>>
    --
    * analysis_name : text
    * analysis_description : text
    * creation_date : text
    * update_date : text
    * expiring_date : text
    * execution_status : integer <<FK>>
    * user_id : text <<FK>>
    * permit_id : text <<FK>>
    * workspace_id : text <<FK>>
}

entity Algorithm {
    * id : text <<generated>>
    --
    * method_name : text
    * creation_date : text
    * update_date : text
    * variables_selected : integer[] <<FK>> 
    * execution_status : integer <<FK>>
    * analysis_id : text <<FK>>
    * workspace_id : text <<FK>>
    * cohort_ids : integer[] <<FK>>
    * results_id : text <<FK>>
}

entity MetadataSearch {
    * id : text <<generated>>
    --
    * update_date : text
    * created_date : text
    * user_id : text <<FK>>
    * type_cancer : text
}

entity Cohort {
    * id : integer <<generated>>
    --
    * query_name : text
    * creation_date : text
    * update_date : text
    * cohort_query : text
    * cohort_result : integer[]
    * analysis_id : text <<FK>>
}

entity VariablesPreparation {
    * id : integer <<generated>>
    --
    * category : text
    * processing_method : text
    * output : text
    * name : text
    * description : text
    * user_id : text <<FK>>
    * workspace_id : text <<FK>>
    * analysis_id : text <<FK>>
}

' Relationships
User }o--|| Team
User }o--|| CoE
User }o--|| UserType
Team ||--o{ Permit
CoE ||--o{ Permit
Workspace ||--o{ Permit
Workspace ||--o{ Analysis
Workspace ||--o{ WorkspaceHistory
Status ||--o{ Permit
Status ||--o{ Workspace
Analysis ||--o{ Algorithm
Analysis ||--o{ Cohort
MetadataSearch ||--o{ Permit
VariablesPreparation ||--o{ Algorithm
VariablesPreparation ||--o{ Analysis
Cohort ||--o{ Analysis

legend
**User**: System users with team and CoE affiliations.
**Workspace**: Collaborative environment with phase tracking.
**Status**: Standardized statuses with type categorization.
**VariablesPreparation**: Track custom variables created during analysis.
**Cohort**: Manage cohort queries and results.
||--o{ : One-to-many relationship
}o--|| : Many-to-one relationship
endlegend

@enduml